---
title: "Benchmarking Celeritas"
author:
  - "Peter Heywood, Research Software Engineer"
institute:
  - "The University of Sheffield"
date: "2025-04-11"
logo: ./img/tuos/UOSLogo_Primary_Violet_RGB.svg
footer: "Benchmarking Celeritas - [GridPP53 & SWIFT-HEP09](https://indico.cern.ch/event/1476120/)"

format:
  revealjs:
    theme: theme/tuos.scss
    embed-resources: false  # only enable when publish-ready for perf reasons
    template-partials:
      - title-slide.html
    # show-notes: separate-page
    slide-number: c
    width: 1050
    height: 700
    margin: 0.1
    min-scale: 0.2
    max-scale: 2.0
    auto-stretch: false
    fontsize: 32px
    navigation-mode: linear
    controls: true
    mouse-wheel: true
    include-after-body:
      - text: |
          <script type="text/javascript">
          Reveal.addEventListener('slidechanged', (event) => {
            const isSnOn = (event.currentSlide.dataset.hideSlideNumber !== 'true');
            Reveal.configure({ slideNumber: isSnOn ? "c" : isSnOn});
          });
          </script>

# title slide background
title-slide-attributes:
  data-background-color: "#f3f3f3" # $tuos-core-presentation-bg
  # data-background-color: "#9ADBE8" # $tuos-powder-blue

include-in-header:
  # Hide the logo from dark slides for now, rather than figuring out how to switch the logo for the white one
  - text: |
      <style>
        .reveal.has-dark-background .slide-logo {
          display: none !important;
        }
      </style>

---


# Celeritas {.section-header background-image="img/tuos/tuos-core-template-arrows.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'}
<!-- # Celeritas {.divider .pale-violet visibility="uncounted" data-hide-slide-number='true'} -->

::: {.callout-important appearance="simple" style="width: 50%; margin: 0 auto 0 0;"}
@todo in-slide image attribution
:::


<!-- Only 20 mins. -->

## Celeritas

:::: {.columns .smaller}
::: {.column width=85%}

> The Celeritas project implements HEP detector physics on GPU accelerator hardware with the ultimate goal of supporting the massive computational requirements of the HL-LHC upgrade.


<!-- > Celeritas is a Monte Carlo particle transport code for simulating High Energy Physics (HEP) detectors on general purpose GPUs.
> Motivated originally by the massive computational requirements of the High Luminosity upgrade to the Large Hadron Collider,
> the code’s goal is to accelerate the most computationally challenging simulation problems in HEP. -->

:::
::: {.column .text-center width=15%}

![](img/celeritas-project/celeritas-square.svg){fig-alt="Celeritas project Logo"}

:::
::::

:::: {.columns}
::: {.column .smaller width=50%}

<!-- - [github.com/celeritas-project/celeritas](https://github.com/celeritas-project/celeritas) -->
- NVIDIA GPUs via [CUDA](https://developer.nvidia.com/cuda-toolkit)
- AMD GPUs via [HIP](https://github.com/ROCm-Developer-Tools/HIP)
- 2 Geometry implementations
  - [ORANGE](https://celeritas-project.github.io/celeritas/user/implementation/orange.html#api-orange) (CUDA/HIP)
  - [VecGeom](https://gitlab.cern.ch/VecGeom/VecGeom) (CUDA)
- Standalone executables
- Software library

:::
::: {.column width=50%}


::: {.callout-note title="More Information"}
"Accelerating detector simulations with Celeritas: performance improvements and new capabilities"

- [CHEP 2024 presentation](https://indico.cern.ch/event/1338689/contributions/6015932/)
- [arXiv:2503.17608](https://arxiv.org/abs/2503.17608)

<!-- @misc{lund2025acceleratingdetectorsimulationsceleritas,
      title={Accelerating detector simulations with Celeritas: profiling and performance optimizations}, 
      author={Amanda L. Lund and Julien Esseiva and Seth R. Johnson and Elliott Biondo and Philippe Canal and Thomas Evans and Hayden Hollenbeck and Soon Yung Jun and Guilherme Lima and Ben Morgan and Stefano C. Tognini},
      year={2025},
      eprint={2503.17608},
      archivePrefix={arXiv},
      primaryClass={physics.comp-ph},
      url={https://arxiv.org/abs/2503.17608}, 
} -->
:::

::: {.text-center .even-smaller}
[github.com/celeritas-project/celeritas](https://github.com/celeritas-project/celeritas)
:::


<!-- ::: {.even-smaller}
> Johnson, Seth R., Amanda Lund, Philippe Canal, Stefano C. Tognini, Julien Esseiva, Soon Yung Jun, Guilherme Lima, et al. 2024. “Celeritas: Accelerating Geant4 with GPUs.” EPJ Web of Conferences 295:11005. [https://doi.org/10.1051/epjconf/202429511005](https://doi.org/10.1051/epjconf/202429511005).
::: -->

:::
::::

## [celeritas-project/regression](https://github.com/celeritas-project/regression)

::: {.smaller}

<!-- > a suite of test problems in Celeritas to track whether 
> the code is able to run to completion without hitting an assertion,
> how the code input options (and processed output) change over time,
> and how the kernel occupancy requirements change in response to growing code complexity -->

> a suite of test problems in Celeritas to track whether
> 
> - the code is able to run to completion without hitting an assertion,
> - how the code input options (and processed output) change over time,
> - how the kernel occupancy requirements change in response to growing code complexity

:::

<!-- [github.com/celeritas-project/regression](https://github.com/celeritas-project/regression) -->

:::: {.columns .smaller}
::: {.column width=55%}

- CPU and GPU runs
- Standalone: `celer-g4`, `celer-sim`
- Library: `geant4` 
- Optional power monitoring 
- Node-level benchmarking

:::
::: {.column width=45%}

- ~22 simulation inputs 
  - 7 geometries
  - orange vs vecgeom
  - simulation options (msc, field)

::: {.text-center .smaller}
[github.com/celeritas-project/regression](https://github.com/celeritas-project/regression)
:::

:::
::::

## celeritas-project/regression

::: {.callout-important title="@todo"}

- celeritas-project/regression more info / sample results

:::


<!-- # Hardware {.divider .pale-violet visibility="uncounted" data-hide-slide-number='true'} -->
# Hardware {.section-header background-image="img/tuos/tuos-core-template-crown.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'}



## Hardware (Upstream)

| Machine                        | CPU                             | GPU            |
| :----------------------------- | :------------------------------ | :------------- |
| [Frontier][frontier-specs]     | 1x AMD “Optimized 3rd Gen EPYC” | 8x AMD MI250x  |
| [Perlmutter][perlmutter-specs] | 1x AMD EPYC 7763                | 4x NVIDIA A100 |

: {.trbg-nv-amd .table-full-width tbl-colwidths="[19,47,34]"}


## Hardware

| Machine                        | CPU                             | GPU                   |
| :----------------------------- | :------------------------------ | :-------------------- |
| [Frontier][frontier-specs]     | 1x AMD “Optimized 3rd Gen EPYC” | 8x AMD MI250x         |
| [Perlmutter][perlmutter-specs] | 1x AMD EPYC 7763                | 4x NVIDIA A100        |
| [JADE 2.5][jade-arc-specs]     | 2x AMD EPYC 9534                | 8x AMD MI300x         |
| [Bede GH200][bede-specs]       | 1x NVIDIA Grace                 | 1x NVIDIA GH200 480GB |
| 3090 (TUoS)                    | 1x Intel i7-5930k               | 2x NVIDIA RTX 3090    |

: {.trbg-nv-amd .shade-r1-r2 .table-full-width tbl-colwidths="[19,47,34]" }


<!-- with footnotes instead, but this does not "print" propperlly -->

<!-- ## Hardware (Upstream)

| Machine                                                                                        | CPU                             | GPU            |
| :--------------------------------------------------------------------------------------------- | :------------------------------ | :------------- |
| Frontier ^[https://docs.olcf.ornl.gov/systems/frontier_user_guide.html#frontier-compute-nodes] | 1x AMD “Optimized 3rd Gen EPYC” | 8x AMD MI250x  |
| Perlmutter ^[https://docs.nersc.gov/systems/perlmutter/architecture/]                          | 1x AMD EPYC 7763                | 4x NVIDIA A100 |

: {.trbg-nv-amd .table-full-width tbl-colwidths="[19,47,34]"} -->


<!-- ## Hardware

| Machine                                                                                        | CPU                             | GPU                   |
| :--------------------------------------------------------------------------------------------- | :------------------------------ | :-------------------- |
| Frontier ^[https://docs.olcf.ornl.gov/systems/frontier_user_guide.html#frontier-compute-nodes] | 1x AMD “Optimized 3rd Gen EPYC” | 8x AMD MI250x         |
| Perlmutter ^[https://docs.nersc.gov/systems/perlmutter/architecture/]                          | 1x AMD EPYC 7763                | 4x NVIDIA A100        |
| JADE@ARC ^[https://jade-arc-docs.readthedocs.io/]                                              | 2x AMD EPYC 9534                | 8x AMD MI300x         |
| Bede GH200 ^[https://bede-documentation.readthedocs.io/en/latest/hardware/]                    | 1x NVIDIA Grace                 | 1x NVIDIA GH200 480GB |
| 3090 (TUoS)                                                                                    | 1x Intel i7-5930k               | 2x NVIDIA RTX 3090    |

: {.trbg-nv-amd .shade-r1-r2 .table-full-width tbl-colwidths="[19,47,34]" } -->


## JADE 2.5 / JADE@ARC

:::: {.columns}
::: {.column .smaller width=60%}

- <u>J</u>oint <u>A</u>ceademic <u>D</u>ata Science <u>E</u>ndeavour 2.5
- UK Tier-2 technology pilot resource
  - Funded by EPSRC
  - Hosted by the University of Oxford
- 3 Lenovo ThinkSystem SR685a V3 Nodes
  - 2 AMD EPYC 9534 64-Core CPUs
  - 8 AMD MI300X GPUs
- Currently in a beta phase
  - i.e. no "real" users yet

:::
::: {.column .text-center width=40%}

![](img/oxford-arc/JADE_2.5_Logo.svg){fig-alt="JADE@ARC Logo"}
![](img/oxford-arc/AMD-MI300X.png){fig-alt="AMD MI300x system image"}

:::
::::

## Bede GH200

:::: {.columns}
::: {.column .smaller width=60%}

- N8 CIR Bede
- UK Tier-2 HPC resource
  - Originally funded by EPSRC
  - Hosted by Durham University
  - Extended by N8 partners for 1 year
- Grace-Hopper pilot
  - 6x NVIDIA GH200 480GB nodes
  - 72-core NVIDIA Grace ARM CPU
  - 96GB Hopper GPU

:::
::: {.column .text-center width=40%}

<style type="text/css">
 .reveal img.gh-fig {
    object-fit:cover; width: 400px; height: 400px;
 }
</style>

![](img/n8-cir-bede/logo-cmyk.png){fig-alt="N8 CIR Bede Logo"}
![NVIDIA Grace Hopper Superchip](img/nvidia/nvidia-gh200-grace-hopper-superchip-platform.png){.gh-fig}

:::
::::

## 2x 3090 Workstation

:::: {.columns}
::: {.column .smaller width=60%}

- Headless Workstation @ TUoS RSE
- 1x Intel i7-5930k (6c 12t) @ 140W 
- 2x NVIDIA RTX 5090 @ 370W
  - Consumer Ampere `SM_86`
  - Limited FP64 hardware
  - ~ equivalent to A40 / RTX A5500 / RTX A6000


::: {.callout-important title="Not an ideal benchmark machine"}

- Originally built in ~2015 as a HEDT workstation
- GPUs upgraded in 2021 
- **Biased towards GPUs**
:::

:::
::: {.column .text-center width=40%}



![](img/ptheywood/waimea.jpg){fig-alt="Picture of Waimea during GPU upgrade" width=400}


:::
::::


<!-- # Benchmarking {.divider .pale-violet visibility="uncounted" data-hide-slide-number='true'} -->
# Benchmarking {.section-header background-image="img/tuos/tuos-core-template-rose.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'}

## Running `celeritas-project/regression`

::: {.callout-important title="@todo"}

- Info about how to run / changes required / example?

- maybe just fold into the results segment?

:::

## Combinations executed / issues encountered.

::: {.callout-important title="@todo"}

- Info about what I ran. 3090 orange only, JADE orange only. BEde both but with some caveats.

- maybe just fold into the results segment?

:::


<!-- # Results {.divider .pale-violet visibility="uncounted" data-hide-slide-number='true'} -->
# Results {.section-header background-image="img/tuos/tuos-core-template-book.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'}


## Results 1 @todo

::: {.callout-important title="@todo"}

- Figure / table for some results / comparisons, depending on what plotting works nicely.

:::


## Results 2 @todo

::: {.callout-important title="@todo"}

- Figure / table for some results / comparisons, depending on what plotting works nicely.

:::

## Results 3 @todo

::: {.callout-important title="@todo"}

- Figure / table for some results / comparisons, depending on what plotting works nicely.

:::

## Results 3 @todo

::: {.callout-important title="@todo"}

- Figure / table for some results / comparisons, depending on what plotting works nicely.

:::

# Thank you {.divider .dark-violet visibility="uncounted" data-hide-slide-number='true'}

:::: {.columns}
::: {.column width=25%}
:::
::: {.column width=50%}


::: {.callout-important title="@todo"}

lots of credit for `celeritas-project/regression` devs.

- [@sethrj](https://github.com/sethrj) - Seth R. Johnson
- [@esseivaju](https://github.com/esseivaju) - Julien Esseiva
- [@amandalund](https://github.com/amandalund) - Amanda Lund
:::

:::
::::

<!-- # Additional Slides {.divider .electric-violet visibility="uncounted" data-hide-slide-number='true'} -->

<!-- # Section header arrows {.section-header background-image="img/tuos/tuos-core-template-arrows.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'} -->

<!-- # Section header rose {.section-header background-image="img/tuos/tuos-core-template-rose.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'} -->

<!-- # Section header crown {.section-header background-image="img/tuos/tuos-core-template-crown.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'} -->

<!-- # Section header book {.section-header background-image="img/tuos/tuos-core-template-book.png" background-size="contain" background-position="right" background-color="#f3f3f3" visibility="uncounted" data-hide-slide-number='true'} -->

<!-- Reference links -->
[perlmutter-specs]: https://docs.nersc.gov/systems/perlmutter/architecture/
[frontier-specs]: https://docs.olcf.ornl.gov/systems/frontier_user_guide.html#frontier-compute-nodes
[bede-specs]: https://bede-documentation.readthedocs.io/en/latest/hardware/index.html
[jade-arc-specs]: https://jade-arc-docs.readthedocs.io/